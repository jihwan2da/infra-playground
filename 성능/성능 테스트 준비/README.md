## 테스트 준비하기
  
### 목적
- 각 시스템의 **응답 성능** 및 **한계치**를 알기 위함이다.
- **부하**가 많이 발생할 때 나타나는 **증상**을 확인하고 성능을 개선할 수 있다. 
- 서비스가 **확장성**을 가졌는지 확인할 수 있다.  
  
### 테스트 종류
**Smoke Test**  
- 최소한의 부하로 구성된 테스트로, 테스트 시나리오에 오류가 없는지 확인할 수 있다.
- 최소 부하 상태에서 시스템에 오류가 발생하지 않는지 확인할 수 있다.
- VUser를 1 ~ 2로 구성하여 테스트한다.  
  
**Load Test**  
- 서비스의 평소 트래픽과 최대 트래픽 상황에서 성능이 어떤지 확인한다. 이 때 기능이 정상 동작하는지도 확인한다.  
- 애플리케이션 배포 및 인프라 변경(scale out, DB failover 등)시에 성능 변화를 확인한다.
- 외부 요인(결제 등)에 따른 예외 상황을 확인한다.
  
**Stress Test**  
- 서비스가 극한의 상황에서 어떻게 동작하는지 확인한다.
- 장기간 부하 발생에 대한 한계치를 확인하고 기능이 정상 동작하는지 확인한다.  
- 최대 사용자 또는 최대 처리량을 확인한다. 
- 스트레스 테스트 이후 시스템이 수동 개입없이 복구되는지 확인한다.  
  
### 테스트 도구
부하 테스트 도구로는 Apache JMeter, nGrinder, Gatling, Locust, K6 등의 도구가 있다.  
- 시나리오 기반의 테스트가 가능해야 한다. 
- 동시 접속자 수, 요청 간격, 최대 Throughput(처리량) 등 부하를 조정할 수 있어야 한다. 
- 부하 테스트 서버 스케일 아웃을 지원하는 등 충분한 부하를 줄 수 있어야 한다.  
  
### 주의할 점
- 성능 테스트는 실제 사용자가 접속하는 환경에서 진행하여야 한다. 내부 네트워크(local)에서 부하를 발생시킬 경우 응답시간에 차이가 발생할 수 있다. 
- 부하 테스트에서는 클라이언트 내부 처리시간이 배제되어 있음을 염두해두어야 한다. 
- 테스트 DB에 들어 있는 데이터의 양이 실제 운영 DB와 동일하여야 한다. 통상 전체 성능의 70% 이상이 DB에 좌우되는데, 테스트 대상이 되는 테이블의 데이터 양이 다르면 쿼리의 실행계획이 달라져 성능이 다르게 나타날 수 있다. 또한 데이터가 소량이면 디스크 입출력이 일어나야 하는데 모두 메모리에 로드되어 성능이 빠른 것으로 착각할 수 있다. 
- 운영환경의 경우, 서비스 요청 외에 별도로 수행되는 배치나 후속작업으로 인한 부하가 있을 수 있다. 서버에 일정하게 발생하는 부하가 있다면 성능 테스트 시나리오에도 포함해야 한다. 
- 외부 요인(결제 등)의 경우 시스템과 분리된 별도의 서버로 구성해야 한다. 객체를 Mocking하는 경우 Http Connection Pool, Connection Thread 등을 미사용하게 되고 IO가 발생하지 않는다. 같은 애플리케이션에 Dummy Controller를 구성하는 경우 테스트 시스템의 자원과 리소스를 같이 사용하므로 테스트의 신뢰성이 떨어진다.  
  

